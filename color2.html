<html>

<body>

    <button onClick="doit()">doit</button>ReallyPink
    <hr />

    <img id="original-image" src="really_pink.png" alt="really pink">
    <canvas id="modified-image"></canvas>

    <script>



// Define the range of hues for pink and green
const minPinkHue = 300; // in degrees
const maxPinkHue = 350; // in degrees
const minGreenHue = 90; // in degrees
const maxGreenHue = 150; // in degrees


// Generate a random green hue
function getRandomGreenHue() {
  const minGreenHue = 90; // in degrees
  const maxGreenHue = 150; // in degrees
  return Math.floor(Math.random() * (maxGreenHue - minGreenHue + 1)) + minGreenHue;
}

// Find pink pixels in the image data and change them to green
function findPinkPixelsAndChangeToGreen(imageData) {
  // Loop through each pixel and convert it from RGB to HSL
  for (let i = 0; i < imageData.data.length; i += 4) {
    const r = imageData.data[i];
    const g = imageData.data[i + 1];
    const b = imageData.data[i + 2];
    const rgb = [r, g, b];
    const hsl = rgbToHsl(rgb);

    // Check if the hue value falls within the range of pink
    if (hsl[0] >= minPinkHue && hsl[0] <= maxPinkHue) {
      // Change the hue value to green and convert back to RGB
      hsl[0] = getRandomGreenHue(minGreenHue, maxGreenHue); // generate a random green hue
      const newRgb = hslToRgb(hsl);

      // Set the new RGB values in the image data
      imageData.data[i] = newRgb[0];
      imageData.data[i + 1] = newRgb[1];
      imageData.data[i + 2] = newRgb[2];
    }
  }

  return imageData;
}

// Convert an RGB color array to an HSL color array
function rgbToHsl(rgb) {
  const r = rgb[0] / 255;
  const g = rgb[1] / 255;
  const b = rgb[2] / 255;

  const max = Math.max(r, g, b);
  const min = Math.min(r, g, b);

  let h, s, l;
  if (max === min) {
    h = 0;
  } else if (max === r) {
    h = ((g - b) / (max - min)) % 6;
  } else if (max === g) {
//    h = (b - r) / (max - min) + 2;
  } else if (max === b) {
    h = (r - g) / (max - min) + 4;
  }
  h = Math.round(h * 60);
  if (h < 0) h += 360;

  l = (max + min) / 2;

  if (max === min) {
    s = 0;
  } else if (l <= 0.5) {
    s = (max - min) / (max + min);
  } else {
    s = (max - min) / (2 - max - min);
  }
  s = Math.round(s * 100);
  l = Math.round(l * 100);

  return [h, s, l];
}

// Convert an HSL color array to an RGB color array
function hslToRgb(hsl) {
  const h = hsl[0];
  const s = hsl[1] / 100;
  const l = hsl[2] / 100;

  const c = (1 - Math.abs(2 * l - 1)) * s;
  const x = c * (1 - Math.abs((h / 60) % 2 - 1));
  const m = l - c / 2;

  let r, g, b;
  if (h < 60) {
    r = c;
    g = x;
    b = 0;
  } else if (h < 120) {
    r = x;
    g = c;
    b = 0;
  } else if (h < 180) {
    r = 0;
    g = c;
    b = x;
  } else if (h < 240) {
    r = 0;
    g = x;
    b = c;
  } else if (h < 300) {
    r = x;
    g = 0;
    b = c;
  } else {
    r = c;
    g = 0;
    b = x;
  }

  r = Math.round((r + m) * 255);
  g = Math.round((g + m) * 255);
  b = Math.round((b + m) * 255);

  return [r, g, b];
}




        function doit() {
            const originalImg = document.getElementById('original-image');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = originalImg.width;
            canvas.height = originalImg.height;

            ctx.drawImage(originalImg, 0, 0);


            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

            // for (let i = 0; i < imageData.data.length; i += 4) {

            //     let r = imageData.data[i + 0]
            //     let g =  imageData.data[i + 1]
            //     let b  = imageData.data[i + 2]
            //     let ary = rgbToHsl(r,g,b)
            //     imageData.data[i] = ary[0]
            //     imageData.data[i + 1] = ary[1]
            //     imageData.data[i + 2] = ary[2]

            //     console.log( r,g,b,ary[0], ary[1], ary[2])


            //     // let r = imageData.data[i + 0]
            //     // let g = imageData.data[i + 1]
            //     // let b = imageData.data[i + 2]

            //     // if (r > 150 && (r - g > 150) && (r - b > 50)) {
            //     //     // FYI: PINK is rgb(159, 43, 104)
            //     //     // and: GREEN is rgb(124,252,0)
            //     //     r -= 100
            //     //     g += 200
            //     //     b -= 50
            //     // }
            //     // imageData.data[i] = r
            //     // imageData.data[i + 1] = g
            //     // imageData.data[i + 2] = b
            // }

            const updatedImageData = findPinkPixelsAndChangeToGreen(imageData);
            ctx.putImageData(updatedImageData, 0, 0);
            originalImg.src = canvas.toDataURL('image/png');
        }
    </script>
</body>


</html>

<!DOCTYPE html>
<html>

<head>
    <style>
        .optional {
            background-color: #ffffe0;
        }

        .mandatory {
            background-color: #ADD8E6;
        }

        #receiveInfo {
            min-width: 1000px;
            min-height: 1000px;
        }

        #left {
            min-width: 500px;
        }

        #jsonToSend {
            width: 98%;
            min-height: 700px;
        }
        #schema {
            min-height:400px; 
        }
        
    </style>
    <link rel="icon" href="data:;base64,=">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <script src="https://assets.adobedtm.com/7a84fdea953b/09aece6f582f/launch-e6cc9ebc113b-development.min.js"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/transformation-configs/latest/transformation-configs-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/validation-configs/latest/validation-configs-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/lam-model/latest/lam-model-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/experiment-module/latest/experiment-module-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/%40lululemon/mwa-analytics/latest/browser/mwa-analytics.js?time=1681256080369"></script>
    <script src="index.js"></script>
</head>

<body>
    <table border'1'>
        <tr>
            <td><button onClick='doFlatten()'>Flatten</button></td>
            <td><button onClick='humanChoseAnEvent("app-response")'>app-response</button></td>
            <td><button onClick='humanChoseAnEvent("error")'>error</button></td>
            <td><button onClick='humanChoseAnEvent("general-component-interaction")'>general-component-interaction</button></td>
            <td><button onClick='humanChoseAnEvent("general-component-event")'>general-component-event</button></td>
            <td><button onClick='humanChoseAnEvent("page-products-displayed")'>page-products-displayed</button></td>
            <td><button onClick='humanChoseAnEvent("page-view")'>page-view</button></td>
            <td><button onClick='humanChoseAnEvent("product-interaction")'>product-interaction</button></td>
            <td><button onClick='humanChoseAnEvent("purchase")'>purchase</button></td>
            <td id="selectedEvent"></td>
            <td><button onClick='showExample()'>showExample</button></td>

        </tr>
    </table>
    <hr />

    <table border="'1">
        <tr>
            <td valign="top" id="left">
                <pre id="schema"></pre>
                <!-- <textarea id="schema" rows="20" cols="100"></textarea> -->

                <hr />
                <button>Send</button>
                <textarea id="jsonToSend"></textarea>
            </td>
            <td valign="top">
                &nbsp;
            </td>
            <td valign="top">
                <button  onClick="switch_view()">Switch view</button>&nbsp;&nbsp;<span id="switch_view">Verify</span>
                <textarea id="receiveInfo" spellcheck="false"></textarea>
            </td>

        </tr>
    </table>

    <script>
        // Poor man's enum
        // This 'enum' will be used to determine what to show on the right hand
        const VERIFY = "verify_actual_restful_call"
        const DATA_LAYER_EXAMPLE = "data_layer_example"
        let VIEWMODE=VERIFY
        let currentEventName
        function switch_view() { 
            let view;
            if ( VIEWMODE === VERIFY ) { 
                view = `<a target="_blank" href="https://lululemon.atlassian.net/wiki/spaces/DCP/pages/2967410421/TDR+Web+NA+-+Reviews+Funnel+Tracking">Data Layer Example</a>`
                VIEWMODE = DATA_LAYER_EXAMPLE
            } else {
                view = 'Verify'
                VIEWMODE = VERIFY
            }
            document.getElementById("switch_view").innerHTML = view
        }
        function showExample() {
            // TODO! Delete this function and its associated  button 
            
        }
        async function init() {
            // new up MwaAnalytics
            await MwaAnalytics.initializeAnalytics('TEST', {}, [], true)
            // set 'everything'
            setEverything(self.validationModule)
            // Roll through and set up the different event objects
            const events = ["app-response", "error", "general-component-interaction", "general-component-event", "page-products-displayed", "page-view", "product-interaction", "purchase"]
            events.forEach((thing) => {
                step0_examineSomething(thing)
            })
            console.log("init! MwaAnalytics.initializeAnalytics")
        }
        function humanChoseAnEvent(eventName) {
            currentEventName = eventName
            document.getElementById("selectedEvent").innerHTML = eventName
            const inputObject = categoricalHoH[eventName]["core"]

            let intermediate = inflateFlatMap(inputObject)
            intermediate = intermediate["default"]["payload"]

            const after = getLeafMaps(intermediate)
// console.log( after)
            const human = after["for_human"]
            const css = after["for_css"]
            // console.log(human)
            // console.log(css)
            const colorered = colorize(human, css)
            document.getElementById("schema").innerHTML = colorered
            document.getElementById("jsonToSend").value = JSON.stringify(intermediate, null, 2)



            if ( VIEWMODE === VERIFY ) {
                document.getElementById("receiveInfo").value = JSON.stringify(categoricalHoH[eventName], null, 2)
            } else {
                document.getElementById("receiveInfo").value = getSnippet(intermediate)
            }

        }
        function getSnippet(json) {
            let x = "THIS WILL TO DATA_LAYER_EXAMPLE\n" + JSON.stringify(categoricalHoH[currentEventName], null, 2)
            x += "HELLO MY DEAR"
            return x 
        }
        function doFlatten() {
            const flat = flatten(everything)
            document.getElementById("selectedEvent").innerHTML = flat
            document.getElementById("receiveInfo").value = JSON.stringify(flat, null, 2)
        }

        init()
    </script>

</body>

</html>
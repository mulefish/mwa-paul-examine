<!DOCTYPE html>
<html>

<head>
    <style>
        .optional {
            color: #ff6633;
        }

        .mandatory {
            color: #0000ff;
        }

        #receiveInfo {
            min-width: 1000px;
            min-height: 1000px;
        }
    </style>
    <link rel="icon" href="data:;base64,=">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <script src="https://assets.adobedtm.com/7a84fdea953b/09aece6f582f/launch-e6cc9ebc113b-development.min.js"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/transformation-configs/latest/transformation-configs-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/validation-configs/latest/validation-configs-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/lam-model/latest/lam-model-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/experiment-module/latest/experiment-module-remoteEntry.js?time=1681256080369"></script>
    <script
        src="https://dxa4wb90x7ize.cloudfront.net/stage/%40lululemon/mwa-analytics/latest/browser/mwa-analytics.js?time=1681256080369"></script>
    <script src="logic.js"></script>
</head>

<body>
    <!-- self.validationModule.categoricalOptionalityObjects 
    <button onClick="doValidationModule()">validationModule</button>-->

    <table border'1'>
        <tr>
            <td><button onClick='doFlatten()'>Flatten</button></td>
            <td><button onClick='doEvent("app-response")'>app-response</button></td>
            <td><button onClick='doEvent("error")'>error</button></td>
            <td><button onClick='doEvent("general-component-interaction")'>general-component-interaction</button></td>
            <td><button onClick='doEvent("general-component-event")'>general-component-event</button></td>
            <td><button onClick='doEvent("page-products-displayed")'>page-products-displayed</button></td>
            <td><button onClick='doEvent("page-view")'>page-view</button></td>
            <td><button onClick='doEvent("product-interaction")'>product-interaction</button></td>
            <td><button onClick='doEvent("purchase")'>purchase</button></td>
            <td id="selectedEvent"></td>
        </tr>
    </table>
    <hr />

    <table border="'1">
        <tr>
            <td valign="top">
                <pre id="schema"></pre>
                <!-- <textarea id="sendInfo"></textarea> -->
            </td>
            <td valign="top">
                &nbsp;
                <!-- <center>
              <button onClick="sendIt()" id="sendBtn"> >>> </button>
            </center> -->
            </td>
            <td>
                <textarea id="receiveInfo"></textarea>
            </td>

        </tr>
    </table>





    <script>
        let schemaObjects;
        let categoricalOptionalityObjects;
        function loadData() {
            schemaObjects =                 self.validationModule.categoricalValidatorObjects
            categoricalOptionalityObjects = self.validationModule.categoricalOptionalityObjects
            const listOfEvents = Object.keys(schemaObjects)
            // const x = flatten(self.validationModule)
            // document.getElementById("receiveInfo").innerHTML = JSON.stringify(x, null, 4)

            document.getElementById("receiveInfo").innerHTML = JSON.stringify(self.validationModule["SCREEN"], null, 4)



        }
        function doEvent(eventName) {
            if (schemaObjects === undefined) {
                loadData()
            }
            const str = categoricalOptionalityObjects[eventName]["default"]["payload"]
            document.getElementById("schema").innerHTML = colorize(str)
            document.getElementById("selectedEvent").innerHTML = eventName
        }

        function colorize(json) {
            const raw = JSON.stringify(json, null, 2)
            const rows = raw.split("\n");
            let output = ""
            rows.forEach((row, i) => {
                let css = "ignore"
                if (row.includes(" false")) {
                    css = "optional"
                } else if (row.includes(" true")) {
                    css = "mandatory"
                }
                output += `<div class='${css}'>${row}</div>`

            })
            return output
        }


        
        function flatten(objectToFlatten) {
            // This will not be used in the logic of the page - but it will be helpful to put this page together
            function flattenObject(obj) {
                const accumulator = {};
                for (let key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        if ((typeof obj[key]) == 'object' && obj[key] != null) {
                            const flatObject = flattenObject(obj[key]);
                            for (let x in flatObject) {
                                if (flatObject.hasOwnProperty(x)) {
                                    accumulator[key + '.' + x] = flatObject[x];
                                }
                            }
                        } else {
                            accumulator[key] = obj[key];
                        }
                    }
                }
                return accumulator;
            }
            return flattenObject(objectToFlatten)
        }

        function doFlatten() {
            const obj = {
                schemaObjects,
                categoricalOptionalityObjects
            }
            const everything = flatten(obj)
            document.getElementById("receiveInfo").innerHTML = JSON.stringify(everything, null, 2 )

        }


    </script>

</body>

</html>